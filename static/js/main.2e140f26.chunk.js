(this["webpackJsonpreact-book-catalog"]=this["webpackJsonpreact-book-catalog"]||[]).push([[0],{38:function(e,t,c){},39:function(e,t,c){},44:function(e,t,c){},50:function(e,t,c){},51:function(e,t,c){},52:function(e,t,c){},54:function(e,t,c){"use strict";c.r(t);var a=c(2),n=c.n(a),s=c(32),r=c.n(s),o=(c(38),c(7)),i=(c(39),c(15)),b=c(6),l=n.a.createContext(),j=c(23);c(55),c(41);j.a.initializeApp({apiKey:"AIzaSyCzhjL5kmDoyu9baGGhnH-dGOgAiNzVxpM",authDomain:"react-book-catalog-b3457.firebaseapp.com",projectId:"react-book-catalog-b3457",storageBucket:"react-book-catalog-b3457.appspot.com",messagingSenderId:"552036910915",appId:"1:552036910915:web:0e3e78422112d9883b11f6"});var u=j.a.auth(),d=j.a.firestore(),m=(j.a,c(18)),h=c.n(m),O=c(26),_=(c(44),c(5)),f=c(19),p=c(1),x=function(e){var t=e.children,c=e.onSubmit,a=Object(f.a)(e,["children","onSubmit"]);return Object(p.jsx)("form",Object(_.a)(Object(_.a)({onSubmit:function(e){e.preventDefault(),c(e.target.elements)}},a),{},{children:t}))},k=function(e){var t=e.name,c=e.value,n=Object(f.a)(e,["name","value"]),s=Object(a.useState)(c||""),r=Object(o.a)(s,2),i=r[0],b=r[1];return Object(p.jsx)("input",Object(_.a)({name:t,value:i,onChange:function(e){return b(e.target.value)}},n))},v=function(e){var t=e.closeForm,c=Object(a.useState)(!1),n=Object(o.a)(c,2),s=n[0],r=n[1],i=Object(a.useState)(),b=Object(o.a)(i,2),l=b[0],j=b[1],d=Object(a.useState)(),m=Object(o.a)(d,2),_=m[0],f=m[1],v=Object(a.useState)(!1),N=Object(o.a)(v,2),g=N[0],y=N[1],w=Object(a.useRef)(),B=function(){var e=Object(O.a)(h.a.mark((function e(c,a,n,s){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y(!0),n(null),e.next=5,c(a).then((function(){y(!1),t()}));case 5:e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),n(s),y(!1),setTimeout(n,4e3,null);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,c,a,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(O.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.createUserWithEmailAndPassword(t.email.value,t.password.value);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(O.a)(h.a.mark((function e(t){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.signInWithEmailAndPassword(t.email.value,t.password.value);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){var e=function(e){e.target===w.current&&t()};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}),[t]),Object(p.jsx)("div",{className:"authForm",ref:w,children:Object(p.jsxs)("div",{className:"authForm__wrapper",children:[Object(p.jsx)("div",{className:"authForm__close-ico-wrapper",children:Object(p.jsx)("i",{className:"authForm__close-ico fas fa-times",onClick:function(){return!g&&t()}})}),Object(p.jsxs)("header",{className:"authForm__header",children:[Object(p.jsx)("div",{className:"authForm__title-btn-wrapper",children:Object(p.jsx)("button",{className:"authForm__title-btn",onClick:function(){return r(!1)},disabled:g,children:"\u0412\u043e\u0439\u0442\u0438"})}),Object(p.jsx)("div",{className:"authForm__title-btn-wrapper",children:Object(p.jsx)("button",{className:"authForm__title-btn",onClick:function(){return r(!0)},disabled:g,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})})]}),s?Object(p.jsxs)(x,{className:"form",onSubmit:function(e){B(S,e,f,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438")},children:[Object(p.jsx)("div",{className:"form__input-wrapper",children:Object(p.jsx)(k,{className:"form__input",type:"email",name:"email",required:!0,placeholder:"\u041f\u043e\u0447\u0442\u0430"})}),Object(p.jsx)("div",{className:"form__input-wrapper",children:Object(p.jsx)(k,{className:"form__input",type:"password",name:"password",required:!0,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"})}),Object(p.jsx)("div",{className:"form__btn-wrapper",children:Object(p.jsx)("button",{className:"form__btn",disabled:g,children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})}),Object(p.jsx)("p",{className:"form__error",children:_})]}):Object(p.jsxs)(x,{className:"form",onSubmit:function(e){B(C,e,j,"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0445\u043e\u0434\u0430")},children:[Object(p.jsx)("div",{className:"form__input-wrapper",children:Object(p.jsx)(k,{className:"form__input",type:"email",name:"email",required:!0,placeholder:"\u041f\u043e\u0447\u0442\u0430"})}),Object(p.jsx)("div",{className:"form__input-wrapper",children:Object(p.jsx)(k,{className:"form__input",type:"password",name:"password",required:!0,placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"})}),Object(p.jsx)("div",{className:"form__btn-wrapper",children:Object(p.jsx)("button",{className:"form__btn",disabled:g,children:"\u0412\u043e\u0439\u0442\u0438"})}),Object(p.jsx)("p",{className:"form__error",children:l})]})]})})},N=document.body,g=function(){var e=Object(a.useContext)(l).user,t=Object(a.useState)(),c=Object(o.a)(t,2),n=c[0],s=c[1],r=Object(a.useRef)(),b=function(){r.current.classList.remove("header__item--active")};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("header",{className:"header",children:Object(p.jsxs)("nav",{className:"header__nav",children:[Object(p.jsx)("div",{className:"header__menu-icon",onClick:function(){return r.current.classList.toggle("header__item--active")},children:Object(p.jsx)("div",{className:"header__menu-line"})}),Object(p.jsxs)("div",{className:"header__item",ref:r,children:[Object(p.jsx)(i.b,{className:"header__text header__link",to:"/react-book-catalog/",onClick:b,children:"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"}),Object(p.jsx)(i.b,{className:"header__text header__link",to:"/react-book-catalog/manage",onClick:b,children:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435"})]}),Object(p.jsx)("div",{className:"header__item",children:e?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("span",{className:"header__text header__auth",children:e.email}),Object(p.jsx)("span",{className:"header__text header__auth",onClick:function(){return u.signOut()},children:"\u0412\u044b\u0439\u0442\u0438"})]}):Object(p.jsx)("span",{className:"header__text header__auth",onClick:function(){N.style.overflow="hidden",s(!0)},children:"\u0412\u043e\u0439\u0442\u0438"})})]})}),n&&Object(p.jsx)(v,{closeForm:function(){N.style.overflow="auto",s(!1)}})]})},y=c(20),w=d.collection("books"),B=function(e){return w.doc(e).delete()},S=function(e,t,c,a){return w.add({authors:e,name:t,year:c,isbn:a}).then((function(e){return e.id}))},C=function(e,t,c,a,n){return w.doc(e).set({authors:t,name:c,year:a,isbn:n})},F=n.a.createContext(),E=d.collection("books"),L=function(){return Object(a.useContext)(F)},I="SET_BOOKS",R="TOGGLE_FETCHING",D="SET_NO_BOOKS_LEFT",q="REMOVE_BOOK",A="ADD_BOOK",T="EDIT_BOOK",G={books:[],fetching:!1,noBooksLeft:!1},K=function(e,t){switch(t.type){case I:return Object(_.a)(Object(_.a)({},e),{},{books:[].concat(Object(y.a)(e.books),Object(y.a)(t.books))});case R:return Object(_.a)(Object(_.a)({},e),{},{fetching:t.fetching});case D:return Object(_.a)(Object(_.a)({},e),{},{noBooksLeft:t.noBooksLeft});case q:return Object(_.a)(Object(_.a)({},e),{},{books:e.books.filter((function(e){return e.id!==t.id}))});case A:return Object(_.a)(Object(_.a)({},e),{},{books:[t.book].concat(Object(y.a)(e.books))});case T:return Object(_.a)(Object(_.a)({},e),{},{books:e.books.map((function(e){return e.id===t.newBookData.id?t.newBookData:e}))});default:return e}},z=function(e){var t=e.children,c=Object(a.useReducer)(K,G),n=Object(o.a)(c,2),s=n[0],r=n[1],i=Object(a.useRef)(),b=function(e){return r({type:R,fetching:e})},l=function(e){return r({type:I,books:e})},j=function(e){return r({type:A,book:e})},u=function(e){return r({type:q,id:e})},d=function(e){return r({type:T,newBookData:e})},m=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;b(!0),E.orderBy("name").startAfter(i.current||0).limit(e).get().then((function(e){if(0!==e.size||s.noBooksLeft){var t=e.docs.map((function(e){return Object(_.a)({id:e.id},e.data())}));l(t),i.current=e.docs[e.docs.length-1]}else r({type:D,noBooksLeft:!0});b(!1)}))}),[s.noBooksLeft]);Object(a.useEffect)((function(){m(10)}),[m]);var h={state:s,books:s.books,fetchingBooks:s.fetching,noBooksLeft:s.noBooksLeft,removeBook:function(e){b(!0),B(e).then((function(){u(e),b(!1)}))},fetchBooks:m,addBook:function(e){var t=e.name,c=e.authors,a=e.year,n=e.isbn;b(!0),S(c,t,a,n).then((function(e){j({id:e,name:t,authors:c,year:a,isbn:n}),b(!1)}))},editBook:function(e,t){var c=t.authors,a=t.name,n=t.year,s=t.isbn;b(!0),C(e,c,a,n,s).then((function(){d({id:e,authors:c,name:a,year:n,isbn:s}),b(!1)}))}};return Object(p.jsx)(F.Provider,{value:h,children:t})},P=function(e){var t=Object(a.useRef)(),c=Object(a.useRef)();return Object(a.useEffect)((function(){c.current=new IntersectionObserver((function(t){Object(o.a)(t,1)[0].isIntersecting&&e()}),{});var a=t.current;return c.current.observe(a),function(){return c.current.unobserve(a)}}),[e]),{observableNodeRef:t,observerRef:c}},M=(c(50),c(51),{padding:".5em 1.25em",backgroundColor:"rgba(106, 150, 185, .85)",border:"1px solid rgb(121, 121, 121)",color:"#fff",borderRadius:"5px",cursor:"pointer",outline:"none"}),H=function(e){var t=e.children,c=Object(f.a)(e,["children"]);return Object(p.jsx)("button",Object(_.a)(Object(_.a)({},c),{},{style:M,children:t}))},J=function(e){for(var t=e.name,c=e.authors,s=e.year,r=e.isbn,i=e.onClick,b=e.type,l=e.provideData,j=Object(a.useState)("edit"===b?c.length:1),u=Object(o.a)(j,2),d=u[0],m=u[1],h=Object(a.useState)(!1),O=Object(o.a)(h,2),_=O[0],f=O[1],v=Object(a.useState)(!1),N=Object(o.a)(v,2),g=N[0],y=N[1],w=[],B=1;B<=d;B++)w.push(Object(p.jsxs)(n.a.Fragment,{children:[Object(p.jsx)(k,{className:"book__input book__input-author",name:"authors",type:"text",placeholder:"\u0410\u0432\u0442\u043e\u0440 ".concat(B),value:c&&c[B-1],required:!0}),1===d?Object(p.jsx)("i",{className:"book__fa-plus fas fa-plus",onClick:function(){return m((function(e){return e+1}))}}):3===d&&B===d?Object(p.jsx)("i",{className:"book__fa-minus fas fa-minus",onClick:function(){return m((function(e){return e-1}))}}):B===d&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("i",{className:"book__fa-plus fas fa-plus",onClick:function(){return m((function(e){return e+1}))}}),Object(p.jsx)("i",{className:"book__fa-minus fas fa-minus",onClick:function(){return m((function(e){return e-1}))}})]})]},B));if("add"===b){return Object(p.jsx)("div",{className:"book",children:_?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"book__img",children:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),Object(p.jsx)("div",{className:"book__desc",children:Object(p.jsxs)(x,{className:"book__form",onSubmit:function(e){l(e),f(!1)},children:[Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"name",type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",required:!0})}),Object(p.jsx)("div",{className:"book__input-wrapper",children:w}),Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"year",type:"number",placeholder:"\u0413\u043e\u0434 \u0438\u0437\u0434\u0430\u043d\u0438\u044f",required:!0})}),Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"isbn",type:"text",placeholder:"ISBN",required:!0})}),Object(p.jsx)("div",{className:"book__btn",children:Object(p.jsx)(H,{children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})})]})})]}):Object(p.jsx)("div",{className:"book__add-book-plus-wrapper",onClick:function(){return f(!0)},children:Object(p.jsx)("i",{className:"book__add-book-plus fas fa-plus"})})})}if("edit"===b){return Object(p.jsx)("div",{className:"book",children:g?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"book__img",children:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),Object(p.jsx)("div",{className:"book__desc",children:Object(p.jsxs)(x,{className:"book__form",onSubmit:function(e){l(e),y(!1)},children:[Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"name",type:"text",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",value:t,required:!0})}),Object(p.jsx)("div",{className:"book__input-wrapper",children:w}),Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"year",type:"number",placeholder:"\u0413\u043e\u0434 \u0438\u0437\u0434\u0430\u043d\u0438\u044f",value:s,required:!0})}),Object(p.jsx)("div",{className:"book__input-wrapper",children:Object(p.jsx)(k,{className:"book__input",name:"isbn",type:"text",placeholder:"ISBN",value:r,required:!0})}),Object(p.jsx)("div",{className:"book__btn",children:Object(p.jsx)(H,{children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("div",{className:"book__img",children:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),Object(p.jsxs)("div",{className:"book__desc",children:[Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: "}),Object(p.jsx)("span",{className:"book__span",children:t})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u0410\u0432\u0442\u043e\u0440: "}),Object(p.jsx)("span",{className:"book__span",children:c.join(", ")})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u0413\u043e\u0434 \u0438\u0437\u0434\u0430\u043d\u0438\u044f: "}),Object(p.jsx)("span",{className:"book__span",children:s})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"ISBN: "}),Object(p.jsx)("span",{className:"book__span",children:r})]})]}),Object(p.jsx)("div",{className:"book__btn",children:Object(p.jsx)(H,{onClick:function(){return y(!0)},children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})})]})})}return Object(p.jsxs)("div",{className:"book",children:[Object(p.jsx)("div",{className:"book__img",children:"\u0418\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435"}),Object(p.jsxs)("div",{className:"book__desc",children:[Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435: "}),Object(p.jsx)("span",{className:"book__span",children:t})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u0410\u0432\u0442\u043e\u0440: "}),Object(p.jsx)("span",{className:"book__span",children:c.join(", ")})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"\u0413\u043e\u0434 \u0438\u0437\u0434\u0430\u043d\u0438\u044f: "}),Object(p.jsx)("span",{className:"book__span",children:s})]}),Object(p.jsxs)("p",{className:"book__desc-item",children:[Object(p.jsx)("b",{children:"ISBN: "}),Object(p.jsx)("span",{className:"book__span",children:r})]})]}),Object(p.jsx)("div",{className:"book__btn",children:Object(p.jsx)(H,{onClick:i,children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})})]})},V=function(){var e=L(),t=e.books,c=e.removeBook,n=e.fetchBooks,s=e.fetchingBooks,r=e.noBooksLeft,o=Object(a.useCallback)((function(){n(5)}),[n]),b=P(o),l=b.observableNodeRef,j=b.observerRef;return Object(a.useEffect)((function(){r&&j.current.unobserve(l.current)}),[r,j,l]),Object(p.jsxs)("div",{className:"books",children:[Object(p.jsx)("div",{className:"books__btn-wrapper",children:Object(p.jsx)(i.b,{className:"books__btn",to:"/react-book-catalog/manage",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043d\u0438\u0433\u0443"})}),Object(p.jsx)("br",{}),Object(p.jsx)("div",{className:"books__library library",children:Object(p.jsx)("ul",{className:"library__list",children:t.map((function(e){return Object(p.jsx)("li",{className:"library__book",children:Object(p.jsx)(J,{name:e.name,year:e.year,authors:e.authors,isbn:e.isbn,onClick:function(){return c(e.id)},btnTitle:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})},e.id)}))})}),Object(p.jsx)("div",{ref:l,className:"books__fetch-point",style:{height:"25px",display:s?"none":"block"}}),Object(p.jsxs)("div",{className:"books__message",children:[r&&!s&&"\u0411\u043e\u043b\u044c\u0448\u0435 \u043a\u043d\u0438\u0433 \u043d\u0435\u0442",!r&&s&&"\u041f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043a\u043d\u0438\u0433\u0438..."]})]})},W=(c(52),function(){var e=L(),t=e.books,c=e.addBook,n=e.fetchBooks,s=e.fetchingBooks,r=e.noBooksLeft,o=e.editBook,i=Object(a.useCallback)((function(){n(5)}),[n]),b=P(i),l=b.observableNodeRef,j=b.observerRef,u=function(e){var t;try{t=Object(y.a)(e.authors).map((function(e){return e.value}))}catch(c){t=[e.authors.value]}return{name:e.name.value,authors:t,year:e.year.value,isbn:e.isbn.value}};return Object(a.useEffect)((function(){r&&j.current.unobserve(l.current)}),[r,j,l]),Object(p.jsxs)("div",{className:"manage",children:[Object(p.jsx)("h2",{className:"manage__title",children:"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043a\u043d\u0438\u0433\u0430\u043c\u0438"}),Object(p.jsx)("div",{className:"manage__library library",children:Object(p.jsxs)("ul",{className:"library__list",children:[Object(p.jsx)("li",{className:"library__book",children:Object(p.jsx)(J,{provideData:function(e){var t=u(e);c(Object(_.a)({},t))},type:"add"})}),t.map((function(e){return Object(p.jsx)("li",{className:"library__book",children:Object(p.jsx)(J,{name:e.name,authors:e.authors,year:e.year,isbn:e.isbn,type:"edit",provideData:function(t){return function(e,t){var c=u(t);o(e,Object(_.a)({},c))}(e.id,t)}})},e.id)}))]})}),Object(p.jsx)("div",{ref:l,className:"books__fetch-point",style:{height:"25px",display:s?"none":"block"}}),Object(p.jsxs)("div",{className:"books__message",children:[r&&!s&&"\u0411\u043e\u043b\u044c\u0448\u0435 \u043a\u043d\u0438\u0433 \u043d\u0435\u0442",!r&&s&&"\u041f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043a\u043d\u0438\u0433\u0438..."]})]})}),U=function(){var e=Object(a.useState)(),t=Object(o.a)(e,2),c=t[0],n=t[1],s=Object(a.useState)(!0),r=Object(o.a)(s,2),j=r[0],d=r[1];Object(a.useEffect)((function(){u.onAuthStateChanged((function(e){d(!1),n(e)}))}),[]);var m={user:c};return Object(p.jsx)(i.a,{basename:"/react-book-catalog",children:!j&&Object(p.jsxs)(l.Provider,{value:m,children:[Object(p.jsx)(g,{}),Object(p.jsx)("div",{id:"page",children:Object(p.jsx)(b.c,{children:Object(p.jsxs)(z,{children:[Object(p.jsx)(b.a,{exact:!0,path:"/",component:V}),Object(p.jsx)(b.a,{path:"/manage",component:W})]})})})]})})};c(53);r.a.render(Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(U,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.2e140f26.chunk.js.map